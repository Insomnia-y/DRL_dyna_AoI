## 二月实验

- [x] 【2.11上午 固定QoS】

机器：75

```sh
# !/bin/sh
source activate yyx_ishen
group='tune-env-fixedsnr-0211'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
for snr in 100 200 300 400;
do
nohup python -u main_DPPO.py --group ${group} --use_fixed_range --snr ${snr} --device cuda:7 >> ${nohup_dir}/0211.log 2>&1 &
done
```

- [x] 【2.11上午 dynaQoS】

机器：75

```sh
# !/bin/sh
source activate yyx_ishen
group='tune-env-dynaQoS-0211'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
for dyna_level in 1 2 3;
do
nohup python -u main_DPPO.py --group ${group} --dyna_level ${dyna_level} --device cuda:6 >> ${nohup_dir}/0211.log 2>&1 &
done
```

- [x] 【2.11下午 future_obs为0、1、2的实验，DPPO】

每添加一步future_obs，状态维度就增加99。加之前的状态维度是238，因此加2步顶天了~

机器：75

环境：dyna_level=2默认值

```sh
# !/bin/sh
source activate yyx_ishen
group='futureobs-0211'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
for future_obs in 0 1 2;
do
nohup python -u main_DPPO.py --group ${group} --future_obs ${future_obs} --device cuda:4 >> ${nohup_dir}/0211.log 2>&1 &
done
```

- [x] 【2.11下午 继续调难环境的data_amount和update_num】

```sh
# !/bin/sh
source activate yyx_ishen
group='tune-env-0211'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
for user_data_amount in 1 5 10;  # 可以只提高user_data_amount，但不能只降低update_num
do
for update_num in 10 5;
do
if [ $update_num == 10 ]
then device="cuda:3"
else
device="cuda:4"
fi
nohup python -u main_DPPO.py --group ${group} --user_data_amount ${user_data_amount} --update_num ${update_num} --device ${device} >> ${nohup_dir}/0211.log 2>&1 &
done
done
```

- [x] 【2.12凌晨 各算法】

```sh
# !/bin/sh
source activate yyx_ishen
group='baselines-0212'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
for algo in DPPO DMPO CPPO IA2C IC3Net;
do
nohup python -u main_DPPO.py --group ${group} --device cuda:5 >> ${nohup_dir}/0212.log 2>&1 &
done
```



- [x] 【2.12下午 向量化后的DPPO 选择合适的进程数】

```sh
# !/bin/sh
source activate yyx_ishen
group='vec-try-0212'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
for n_thread in 4 8 16;
do
nohup python -u main_DPPO.py --group ${group} --n_thread ${n_thread} --device cuda:6 >> ${nohup_dir}/0212.log 2>&1 &
done
```



- [ ] 【2.12下午 DPPO中扩展值函数的ablation】

```sh
# !/bin/sh
source activate yyx_ishen
group='extendV-ablation-0212'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
nohup python -u main_DPPO.py --group ${group} --n_thread 4 --device cuda:6 >> ${nohup_dir}/0212.log 2>&1 &
nohup python -u main_DPPO.py --group ${group} --n_thread 4 --use-extended-value --device cuda:6 >> ${nohup_dir}/0212.log 2>&1 & 
```

不使用扩展值函数的实验不知道为啥两次都没做成功，不过偶然发现首次保存的轨迹还挺能动。。不过reward里也没有关于能量消耗的罚项呀。。神奇

<img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230214112408544.png" alt="image-20230214112408544" style="zoom:33%;" />

【2.14中午 重新做以上实验 fix actor没有stub的bug】





- [ ] 【2.12晚上 DMPO 比较model使用GCN和yyx实现的最简单的mlp】

```sh
# !/bin/sh
source activate yyx_ishen
group='dmpo-mlp-0212'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
nohup python -u main_DPPO.py --algo DMPO --group ${group} --n_thread 4 --use-mlp-model --device cuda:3 >> ${nohup_dir}/0212.log 2>&1 &
nohup python -u main_DPPO.py --algo DMPO --group ${group} --n_thread 4 --device cuda:3 >> ${nohup_dir}/0212.log 2>&1 &
```

【2.13中午 重新做以上实验， 并加一个multi-mlp】

> DMPO 验证实验后期会出现nan
>
> DMPO --use-mlp-model根本没优化model，为什么效果反而好。。

```sh
python main_DPPO.py --algo DMPO --group 'dmpo-mlp-0212' --n_thread 4 --use-mlp-model --multi-mlp --device cuda:3
```



- [x] 【2.13下午 继续调环境，dyna_level=4, timestep=120or240, uav_num=6, 每个无人机update_num=5, 每个poi amount=5】

```sh
# !/bin/sh
source activate yyx_ishen
group='more-ts-uav-0213'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
nohup python -u main_DPPO.py --group ${group} --dyna_level 4 --max_episode_step 120 --uav_num 6 --update_num 5 --user_data_amount 5 --device cuda:4 >> ${nohup_dir}/0213.log 2>&1 &
nohup python -u main_DPPO.py --group ${group} --dyna_level 4 --max_episode_step 240 --uav_num 6 --update_num 5 --user_data_amount 5 --device cuda:4 >> ${nohup_dir}/0213.log 2>&1 &
```



- [x] 【2.14下午 G2ANet】

```sh
# !/bin/sh
source activate yyx_ishen
group='g2anet-0214'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
nohup python -u main_DPPO.py --group ${group} --dyna_level 4 --update_num 5 --user_data_amount 5 --device cuda:4 >> ${nohup_dir}/0214.log 2>&1 &
nohup python -u main_DPPO.py --group ${group} --algo G2ANet --dyna_level 4 --update_num 5 --user_data_amount 5 --device cuda:4 >> ${nohup_dir}/0214.log 2>&1 &
```



- [ ] 【2.14下午 对比是否使用最naive的snrmap】

```sh
# !/bin/sh
source activate yyx_ishen
group='snrmap-0214'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
for algo in DPPO G2ANet;
do
nohup python -u main_DPPO.py --group ${group} --algo ${algo} --dyna_level 4 --update_num 5 --user_data_amount 5 --device cuda:4 >> ${nohup_dir}/0214.log 2>&1 &
nohup python -u main_DPPO.py --group ${group} --algo ${algo} --use_snrmap --dyna_level 4 --update_num 5 --user_data_amount 5 --device cuda:4 >> ${nohup_dir}/0214.log 2>&1 &
done
```

30k浅看已经定调了，w/o snrmap并无显著差距，现在dppo和G2ANet差距太大

<img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20230214181201658.png" alt="image-20230214181201658" style="zoom: 25%;" />



【2.15 下午 调环境固定timeslot里收集时间】

```sh
# !/bin/sh
source activate yyx_ishen
group='fixed-col-time-0215'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
nohup python -u main_DPPO.py --group ${group} --dyna_level 4 --update_num 5 --user_data_amount 5 --device cuda:4 >> ${nohup_dir}/0214.log 2>&1 &
nohup python -u main_DPPO.py --group ${group} --fixed-col-time --dyna_level 4 --update_num 5 --user_data_amount 5 --device cuda:4 >> ${nohup_dir}/0214.log 2>&1 &
```



【2.15下午 在dyna_level==cluster场景上调收集时间】

```sh
# !/bin/sh
source activate yyx_ishen
group='0215-cluster'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
nohup python -u main_DPPO.py --group ${group} --dyna_level cluster --update_num 5 --user_data_amount 5 --device cuda:4 >> ${nohup_dir}/0214.log 2>&1 &
nohup python -u main_DPPO.py --group ${group} --fixed-col-time --dyna_level cluster --update_num 5 --user_data_amount 5 --device cuda:4 >> ${nohup_dir}/0214.log 2>&1 &
```

![image-20230215164615133](https://cdn.jsdelivr.net/gh/1candoallthings/figure-bed@main/img/202302151646430.png)



【2.15晚上 SSTSS】

为进一步导向有故事的轨迹图：

- 从根据初始位置划分用户改为同一时刻同一地点的人SNRth类似 （OK）
- amount恒为5太大，改为amount根据采集时刻的SNRth变化，SNRth越小amount越大，范围为(1,3) （OK）
- 三个无人机不够，再加1-2个，做4-5个uav的实验 （OK）

注意：

1)这组实验里有最原始的setting作为比较的基准 

2)以后每次调环境都加上`--use_extended_value`也即用ippo来调环境 去除和邻域通信的影响（在更新的版本里实现了IPPOAgent）



```sh
# !/bin/sh
source activate yyx_ishen
group='0215-SSTSS'
nohup_dir='../nohup_log'
mkdir -p ${nohup_dir}
for uav_num in 3 4 5;
do
for update_num in 5 10;
do
nohup python -u main_DPPO.py --group ${group} --use_extended_value --dyna_level SSTSS --update_num ${update_num} --uav_num ${uav_num} --device cuda:3 >> ${nohup_dir}/0215.log 2>&1 &
nohup python -u main_DPPO.py --group ${group} --use_extended_value --dyna_level SSTSS --update_num ${update_num} --uav_num ${uav_num} --amount_prop_to_SNRth --device cuda:4 >> ${nohup_dir}/0215.log 2>&1 &
done
done
```



|                 | episodic AoI | delay requirement meeting ratio | data rate requirement meeting ratio | energy consumption ratio |
| --------------- | ------------ | ------------------------------- | ----------------------------------- | ------------------------ |
| ours            |              |                                 |                                     |                          |
| ours w/o snrmap |              |                                 |                                     |                          |
| ours w/o G2ANet |              |                                 |                                     |                          |
| ours w/o both   |              |                                 |                                     |                          |







### 0216环境改动check list

- [ ] user每个时刻都生成一个包，被分到的（依据平分）带宽越多，在固定12.5s的收集时间内就有更多的包能被收集，aoi reset越明显。











每个无人机根据sensing range填充访问user列表：

0号UAV：[1,2] 

1号UAV：[0,1,5] 

2号UAV：[5,6,...]

计算1号user的data rate：

由于多个user被同一uav服务时需平分它的带宽（user之间仅在带宽上竞争，并不在时间上竞争），1号user被0号uav和1号uav服务时分别分得$B/2$、$B/3$的带宽，分别带入到两个user的距离计算snr并用香农公式计算data rate，求和得到总data rate

如果仅凭0号或1号uav单独访问都无法满足1号poi的data rate th，但合作后的总data rate可以满足，则给两者bonus奖励

